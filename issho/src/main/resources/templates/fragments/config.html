<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head th:fragment="configFragment">


<th:block th:fragment="config">
	<meta charset="UTF-8" />
	<!-- 공통으로 쓰이는 css파일을 넣는다.-->
	<link rel="stylesheet" th:href="@{/css/sb-admin-2.min.css}">
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />
	<link
		href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
		rel="stylesheet">

	<style>
.headerDiv {
	border: 3px solid blueviolet;
}

body {
	font-family: Pretendard-Regular;
}
</style>
	<!-- 컨텐츠페이지의 CSS 영역이 들어감 -->


	<!-- 공통으로 쓰이는 js 파일을 넣는다.-->
	<script th:src="@{/js/jquery-3.6.0.min.js}"></script>
	<script th:src="@{/js/sb-admin-2.js}"></script>

	<!-- Bootstrap core JavaScript-->
	<script th:src="@{/vendor/jquery/jquery.min.js}"></script>
	<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>

	<!-- Core plugin JavaScript-->
	<script th:src="@{/vendor/jquery-easing/jquery.easing.min.js}"></script>


	<!-- 컨텐츠페이지의 스크립트 영역이 들어감 -->

	<script th:inline="javascript">
		$(function() {
			$("#sidebarToggle, #sidebarToggleTop").on('click', function(e) {
				$("body").toggleClass("sidebar-toggled");
				$(".sidebar").toggleClass("toggled");
				if ($(".sidebar").hasClass("toggled")) {
					$('.sidebar .collapse').collapse('hide');
				}
				
			});
			
			if([[${#authentication.principal != "anonymousUser"}]]){
				console.log('subscribe 함수')
				
				let sseLink = [[@{/push/subscribe}]];
				const eventSource = new EventSource(sseLink);
				
				eventSource.addEventListener("sse", function(event){
					
					console.log("event.data");
					console.log(event.data);
					
					const data = JSON.parse(event.data);
					
					
					if(data.content != 'subscribe 성공')
						showNotification(data);
					
					/* (async () => {
						
						const showNotification = () => {
							openNotification(data);
						}
						
						let granted = false;
						
						if(Notification.permission === 'granted'){
							granted = true;
						} else if(Notification.permission !== 'denied'){
							let permission = await Notification.requestPermission();
							granted = permission === 'granted';
						}
						
						if(granted){
							showNotification();
						}
					}); */
				});
			}
		});
		
		/*
		function showNotification(obj){
			console.log('실행됨');
				$('#notifi').text(obj.content);
			
			  $('.toast').toast('show');
			
			
		}
		*/
		
	
		
		
	</script>

</th:block>

<th:block layout:fragment="css"></th:block>


<th:block layout:fragment="script"></th:block>

</head>

</html>